//emp.h file

#define ARRAY_ALLOC_FAIL NULL
#define INT_ALLOC_FAIL NULL
#define ARRAY_DEALLOC -1
#define ARRAY_FULL 9
#define INSERT_SUCCESS 1
#define FOUND 1
#define NOT_FOUND 0
#define NOT_UNIQUE 7
#define BKUP_ALLOC_FAIL NULL
#define UPTO_DATE 1
#define BKUP_REQUIRED 0
#define SUCCESS 1
#define ABORT -1
#define NAME_SIZE 15
#define DESIG_SIZE 20

struct _employee_
{
    int emp_id;
    char emp_name[NAME_SIZE];
    float emp_sal;
    char emp_desig[DESIG_SIZE];
    int age;
};
typedef struct _employee_ Employee;
struct _array_
{
    Employee *arr;
    int *bkup;
    int c_size, t_size;
    int bkup_status;
};
typedef struct _array_ Array;

Array * initialise_array(int);
int insert_data(Array *, Employee data);
int search(Array *, int empid);
void display(Array *);
void sort_by_age(Array *);

//Practice problems
float get_average_hr_salary(Array *);
Employee get_employee_details(Array *, char *emp_name);
int terminate_employee(Array *, int emp_id);
int count_employees_by_location(Array *, char *location);
Array * deallocate(Array *);




//emp.op.c file

#include<stdlib.h>
#include<stdio.h>
#include <assert.h>
#include "employee.h"

Array * initialise_array(int size)
{
    Array *my_arr;
    my_arr =(Array *)malloc(sizeof(Array));
    if(NULL == my_arr) return ARRAY_ALLOC_FAIL;

    my_arr->c_size = 0;
    my_arr->t_size = size;
    my_arr->arr = (Employee *)malloc(sizeof(Employee) * size);
    my_arr->bkup_status = UPTO_DATE;

    if(NULL == my_arr->arr){
        free(my_arr);
        return INT_ALLOC_FAIL;
    }

    return my_arr;
}

int insert_data(Array *my_arr, Employee data)
{
    if(my_arr == NULL) return ARRAY_DEALLOC;

    if(my_arr->c_size == my_arr->t_size) return ARRAY_FULL;

    *(my_arr->arr + my_arr->c_size) = data;
    my_arr->c_size++;

    return INSERT_SUCCESS;
}
int search(Array *my_arr, int id)
{
    int i;

    for(i=0; i <my_arr->c_size; i++)
        if((my_arr->arr+i)->emp_id == id) return FOUND;
    return NOT_FOUND;
}

void sort_by_age(Array *my_arr)
{
    int i, j;
    Employee temp;
    int flag;
    for(i=0;i<my_arr->c_size; i++){
        flag = 0;
        for(j=0; j<my_arr->c_size-1-i; j++){
            if((my_arr->arr+j)->age > (my_arr->arr+j+1)->age){
                flag = 1;
                temp = my_arr->arr[j];
                my_arr->arr[j] = my_arr->arr[j+1];
                my_arr->arr[j+1] = temp;
            }
        }
        if(flag == 0) return;
    }
}

void display(Array *my_arr)
{
    int i;
    printf("\n");
    for(i=0; i<my_arr->c_size; i++)
        printf("\n%d %s %d %f %s",//
               (my_arr->arr+i)->emp_id,//
               (my_arr->arr+i)->emp_name, //
               (my_arr->arr+i)->age, //
               (my_arr->arr+i)->emp_sal, //
               (my_arr->arr+i)->emp_desig);
}

Array * deallocate(Array *my_arr)
{
    if(my_arr == NULL) return NULL;

    free(my_arr->arr);
    free(my_arr);

    return NULL;
}

//main.c file

#include <stdio.h>
#include <stdlib.h>
#include <assert.h>
#include<string.h>
#include "employee.h"

int main()
{
    Array *test;
    Employee emp;

    test = initialise_array(5);
    assert(test->c_size == 0);
    assert(test->t_size == 5);

    emp.emp_id = 1001;
    strcpy(emp.emp_name,"Raj");
    strcpy(emp.emp_desig,"HR");
    emp.age = 31;
    emp.emp_sal = 100000;
    assert(insert_data(test, emp));
    assert(test->c_size == 1);
    assert(test->arr->emp_id == 1001);

    emp.emp_id = 1002;
    strcpy(emp.emp_name,"Rajan");
    strcpy(emp.emp_desig,"HR Executive");
    emp.age = 24;
    emp.emp_sal = 120000;
    assert(insert_data(test, emp));

    emp.emp_id = 1003;
    strcpy(emp.emp_name,"Rajani");
    strcpy(emp.emp_desig,"HR");
    emp.age = 35;
    emp.emp_sal = 200000;
    assert(insert_data(test, emp));

    emp.emp_id = 1004;
    strcpy(emp.emp_name,"Rajesh");
    strcpy(emp.emp_desig,"SE");
    emp.age = 24;
    emp.emp_sal = 80000;
    assert(insert_data(test, emp));

    emp.emp_id = 1005;
    strcpy(emp.emp_name,"Rajiv");
    strcpy(emp.emp_desig,"HR");
    emp.age = 49;
    emp.emp_sal = 300000;
    assert(insert_data(test, emp));
    assert((test->arr+4)->emp_id == 1005);
    assert(test->c_size == 5);

    emp.emp_id = 1006;
    strcpy(emp.emp_name,"Rajiv");
    strcpy(emp.emp_desig,"Sr. Manager");
    emp.age = 49;
    emp.emp_sal = 300000;
    assert(insert_data(test, emp) == ARRAY_FULL);

    assert(search(test, 1001) == FOUND);
    assert(search(test, 1005) == FOUND);
    assert(search(test, 1006) == NOT_FOUND);
    sort_by_age(test);
    display(test);

    test = deallocate(test);
    assert(test == NULL);
    return 0;
}
